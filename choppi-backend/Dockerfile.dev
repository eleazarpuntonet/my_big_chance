FROM node:20-alpine

# Instalar netcat para verificar conectividad con PostgreSQL
RUN apk add --no-cache netcat-openbsd

WORKDIR /app

# Copiar archivos de dependencias primero
COPY package*.json ./

# Instalar dependencias
RUN npm install

# Copiar el resto del código fuente
COPY . .

# Hacer ejecutable el script de inicialización
RUN chmod +x init-db.sh

# Exponer el puerto
EXPOSE 3000

# Comando por defecto (puede ser sobreescrito en docker-compose)
CMD ["./init-db.sh", "npm", "run", "start:dev"]
